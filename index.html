<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <link rel="stylesheet" href="maxcdn.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="leafletManual.css"/>

    <link rel="stylesheet" href="css/leaflet.extra-markers.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
          integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
            integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
            crossorigin=""></script>
    <style>
        #map {
            position: absolute;
            width: 100%;
            height: 94%;
            top:0;
            right:0;
            left:0;
        }
        .headcontainer{
            width: 100%;
            position: absolute;
            height: 42px;
            bottom: 0;
            left:0;
            z-index: 4;
            background-size: cover;
            background-repeat:no-repeat;
            background-position: 50% 50%;
        }
        .button {
            background-color: #f44336; /* Red */
            border: none;
            color: white;
            width: 17%;
            height: 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            position:relative;
            left: 1px;
            top: 3px;

        }
        .button:hover{
            opacity: .7;

        }
        @media (max-width: 460px) {
            .button {
                border: none;
                color: white;
                width: 21%;
                height: 28px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
                position:relative;
                left: 1%;
                top: 3px;


            }
            .button4{
                value: 'Loc';
            }
        }

        .button3 {background-color: #565157;}
        .button4 {background-color: #122b40;}
        .button5 {background-color: #a8023e;}
        .button6 {background-color: #1502a8;}
        .button7 {background-color: #00a814;}

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }
        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }
        .sidenav a:hover {
            color: #f1f1f1;
        }
        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        @media screen and (max-height: 50px) {
            .sidenav {padding-top: 15px;}
            .sidenav a {font-size: 18px;}
        }
    </style>

</head>
<body>

<script src="./jquery-3.2.1.min.js"></script>
<script src="./leaflet-src.js"></script>
<script src="./leaflet.js"></script>

<script src="js/leaflet.extra-markers.min.js"></script>

<script src="./leaflet-sidebar/src/L.Control.Sidebar.js"></script>
<link rel="stylesheet" href="./leaflet-sidebar/src/L.Control.Sidebar.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<script src="https://unpkg.com/esri-leaflet@2.0.8"></script>

<link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.4/dist/esri-leaflet-geocoder.css">
<script src="https://unpkg.com/esri-leaflet-geocoder@2.2.4"></script>

<div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="#">Electric Line</a>
    <a href="#">Fallen Tree</a>
    <a href="#">Point</a>
</div>

<div id="headerImage" style="z-index: 1000; background-color: white; width: 100%;" class="headcontainer" >
    <button id = "login" class="button button3" onclick="login()">Login</button>
    <button id = "locate" class="button button4" onclick="locate()">Locate</button>
    <button id = "marker"  class="button button5" onclick="marker()">Marker</button>
    <button id = "openNav" class="button button6" onclick="labelArea()">Label Area</button>
    <button id = "trace" class="button button7" onclick="track()">Trace</button>
</div>

<div id='map' class="leaflet-container"></div>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@0.4.9/dist/leaflet.draw.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://cdn.rawgit.com/mejackreed/Leaflet-IIIF/v1.0.1/leaflet-iiif.js"></script>
<script src="https://unpkg.com/leaflet-draw@0.4.9/dist/leaflet.draw.js"></script>

<script>

    $('#locate').hide();
    $('#marker').hide();
    $('#openNav').hide();
    $('#trace').hide();
    //Creates the basemap
    let map = L.map('map').setView([42.877742, -97.380979], 4);
    //Portland 43.6515, -70.2553
    // Additional maps
    let Satellite = L.tileLayer("https://{s}.tiles.mapbox.com/v3/nbtsolutions.jbn3ge2f/{z}/{x}/{y}.png", {
        subdomains: 'abcd',
        maxZoom: 19
    });

    Satellite.addTo(map);

    function login() {
        let login = document.getElementById("login");
        let user = prompt("Account Name:", " ");
        let user_password = prompt("Password:", " ");
        if (user == "Cramer" && user_password == 'password') {
            alert("Hello " + user + "! How are you today?");

            $('#login').hide();
            $('#locate').show();
            $('#marker').show();
            $('#openNav').show();
            $('#trace').show();

        }
                else
             {
            alert("Nice Try Guy!!");
        }
    }

    //User Location Tool
    let currentPosition, currLatlngObject;
    let currentLatlng = [];

    function onLocationFound(e) {

        if (currentPosition) {
            map.removeLayer(currentPosition);
        }
//        let redMarker = L.ExtraMarkers.icon({
//            icon: 'fa-coffee',
//            markerColor: 'red',
//            shape: 'square',
//        });
//        icon: redMarker,
        currentPosition = L.marker(e.latlng,{title: "Location", draggable: false, color: "red"}).addTo(map);

        currLatlngObject = currentPosition._latlng;

        currentLatlng.push(currLatlngObject.lat);
        currentLatlng.push(currLatlngObject.lng);

        currentPosition.bindPopup("You are Here!").openPopup(console.log("Located"));
        map.setView([currentPosition._latlng.lat,currentPosition._latlng.lng],12);

    }

    function onLocationError(e) {
        console.log("location lost");
        console.log(e);
    }
    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    function locate() {
        map.locate({ maxZoom: 16});

    }

    let results = L.layerGroup().addTo(map);
    //GeoSearch plugin
    let searchControl = L.esri.Geocoding.geosearch().addTo(map);
    //Search Control
    searchControl.on('results', function(data){
        //Clears the results LayerGroup from the map
        results.clearLayers();

        for (let i = data.results.length - 1; i >= 0; i--) {
            //Displaying the searched and found location on the map
            let geoLocation = L.marker(data.results[i].latlng);

            results.addLayer(geoLocation);
        }

    });

    //Drawing Features being created
    let labelCount = 1;
    var drawnItems = new L.FeatureGroup();
    // Initialise the draw control and pass it the FeatureGroup of editable layers
    var drawControl = new L.Control.Draw({
        edit: {
            featureGroup: drawnItems
        }
    });
    map.on(L.Draw.Event.CREATED, function (e) {
        var type = e.layerType;
        var layer = e.layer;

        // Do whatever else you need to. (save to db, add to map etc)

        drawnItems.addLayer(layer);
    });

    function labelArea() {

        if (labelCount===1) {
            // Initialise the FeatureGroup to store editable layers
            map.addLayer(drawnItems);

            map.addControl(drawControl);

           console.log(labelCount);

            labelCount++;
        }
        else {
            map.removeControl(drawControl);
            map.removeControl(drawnItems);
            labelCount--;
            console.log(labelCount);
        }
    }

//Creating markers and popup displays
    let allMarkers = L.layerGroup([]);
    let users = L.layerGroup([]);
    let shelters = L.layerGroup([]);

    let newmarker = L.marker([44.808147, -68.795013]).addTo(allMarkers).addTo(users);
    newmarker.bindPopup(
        'User: Bob'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker1 = L.marker([44.808147, -68.785013]).addTo(allMarkers).addTo(users);
    newmarker1.bindPopup(
        'User: Fred'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker2 = L.marker([44.818147, -68.775013]).addTo(allMarkers).addTo(users);
    newmarker2.bindPopup(
        'User: Susan'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker3 = L.marker([44.808147, -68.765013]).addTo(allMarkers).addTo(users);
    newmarker3.bindPopup(
        'User: Carl'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker4 = L.marker([46.808147, -68.795013]).addTo(allMarkers).addTo(users);
    newmarker4.bindPopup(
        'User: Matty O'+'</br>'+'<br/>'+
        'Status: AYYYYY HELP'+'</br>'
    ).openPopup(console.log("User"));

    let markerCount = 1;
    let Markers = {
        "All": allMarkers,
        "Users": users,
        "Shelters": shelters,
    };
    let markerControls = L.control.layers(Markers, null);
    function marker(){

        if (markerCount === 1) {

            markerControls.addTo(map);
            markerCount++
        }
        else{
            markerControls.removeControl(map);
            markerCount--;
        }

//        let currentMarker;
//
//        map.on("click", function (event) {
//            if (currentMarker) {
//                currentMarker._icon.style.transition = "transform 0.3s ease-out";
//                currentMarker._shadow.style.transition = "transform 0.3s ease-out";
//
//                currentMarker.setLatLng(event.latlng);
//
//                setTimeout(function () {
//                    currentMarker._icon.style.transition = null;
//                    currentMarker._shadow.style.transition = null;
//                }, 300);
//                return;
//            }
//
//            currentMarker = new L.marker(event.latlng, {
//                draggable: true
//            }).addTo(map).on("click", function () {
//                event.originalEvent.stopPropagation();
//            });
//
//            currentMarker.bindPopup(
//                'Marker Attributes'+'</br>'+'<br/>'+
//                'Marker Type Name:'+'</br>'+'<br/>'+
//                'User Text Insertion:'+'</br>'+'<br/>'+
//                'User Provided Photo/Video:'+'<br/>'+'<br/>'+
//                '<br/>'+
//                '<br/>'+'.'
//            ).openPopup(console.log("New Position"));
//
//        });
//
//        document.getElementById("done").addEventListener("click", function () {
//            currentMarker = null;
//        });


    }


</script>

</body>

</html>