<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <link rel="stylesheet" href="maxcdn.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="leafletManual.css"/>

    <link rel="stylesheet" href="css/leaflet.extra-markers.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
          integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
            integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
            crossorigin=""></script>
    <style>
        #map {
            position: absolute;
            width: 100%;
            height: 94%;
            top:0;
            right:0;
            left:0;
        }
        .headcontainer{
            width: 100%;
            position: absolute;
            height: 42px;
            bottom: 0;
            left:0;
            z-index: 4;
            background-size: cover;
            background-repeat:no-repeat;
            background-position: 50% 50%;
        }
        .button {
            background-color: #f44336; /* Red */
            border: none;
            color: white;
            width: 17%;
            height: 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            position:relative;
            left: 1px;
            top: 3px;

        }
        .button:hover{
            opacity: .7;

        }
        @media (max-width: 460px) {
            .button {
                border: none;
                color: white;
                width: 21%;
                height: 28px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
                position:relative;
                left: 1%;
                top: 3px;

            }
            .button4{
                value: 'Loc';
            }
        }

        .button3 {background-color: #565157;}
        .button4 {background-color: #122b40;}
        .button5 {background-color: #a8023e;}
        .button6 {background-color: #1502a8;}
        .button7 {background-color: #00a814;}

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }
        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }
        .sidenav a:hover {
            color: #f1f1f1;
        }
        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        @media screen and (max-height: 50px) {
            .sidenav {padding-top: 15px;}
            .sidenav a {font-size: 18px;}
        }



        .login-page {
            width: 100%;
            min-height: 100%;
            padding: 18% 0 0;
            margin: auto;
            background: url("backgroundImage.jpg") no-repeat;
            background-size: 100%;

        }
        .form {
            position: relative;
            z-index: 1;
            background: #FFFFFF;
            max-width: 360px;
            margin: 0 auto 100px;
            padding: 45px;
            text-align: center;
            box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
        }
        .form input {
            font-family: "Roboto", sans-serif;
            outline: 0;
            background: #f2f2f2;
            width: 100%;
            border: 0;
            margin: 0 0 15px;
            padding: 15px;
            box-sizing: border-box;
            font-size: 14px;
        }
        .form button {
            font-family: "Roboto", sans-serif;
            text-transform: uppercase;
            outline: 0;
            background: #1502a8;
            width: 100%;
            border: 0;
            padding: 15px;
            color: #FFFFFF;
            font-size: 14px;
            -webkit-transition: all 0.3 ease;
            transition: all 0.3 ease;
            cursor: pointer;
        }
        .form button:hover,.form button:active,.form button:focus {
            background: #1502a8;
        }
        .form .message {
            margin: 15px 0 0;
            color: #b3b3b3;
            font-size: 12px;
        }
        .form .message a {
            color: #1502a8;
            text-decoration: none;
        }
        .form .register-form {
            display: none;
        }
        .form .appName {
            margin: 0 0 20px;
            color: #000000;
            font-size: 48px;
        }


    </style>

</head>
<body style="height: 100%;">

<script src="./jquery-3.2.1.min.js"></script>
<script src="./leaflet-src.js"></script>
<script src="./leaflet.js"></script>

<script src="js/leaflet.extra-markers.min.js"></script>

<script src="./leaflet-sidebar/src/L.Control.Sidebar.js"></script>
<link rel="stylesheet" href="./leaflet-sidebar/src/L.Control.Sidebar.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<script src="https://unpkg.com/esri-leaflet@2.0.8"></script>

<link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.4/dist/esri-leaflet-geocoder.css">
<script src="https://unpkg.com/esri-leaflet-geocoder@2.2.4"></script>

<div id="mapPage">

<div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="#">Electric Line</a>
    <a href="#">Fallen Tree</a>
    <a href="#">Point</a>
</div>

<div id="headerImage" style="z-index: 1000; background-color: white; width: 100%;" class="headcontainer" >
    <button id = "locate" class="button button4" onclick="locate()">Locate</button>
    <button id = "marker"  class="button button5" onclick="marker()">Marker</button>
    <button id = "openNav" class="button button6" onclick="labelArea()">Label Area</button>
    <button id = "trace" class="button button7" onclick="track()">Trace</button>
</div>

<div id='map' class="leaflet-container"></div>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@0.4.9/dist/leaflet.draw.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://cdn.rawgit.com/mejackreed/Leaflet-IIIF/v1.0.1/leaflet-iiif.js"></script>
<script src="https://unpkg.com/leaflet-draw@0.4.9/dist/leaflet.draw.js"></script>

<script>
    //Creates the basemap
    let map = L.map('map').setView([42.877742, -97.380979], 4);
    //Portland 43.6515, -70.2553
    // Additional maps

    let Satellite = L.tileLayer("https://{s}.tiles.mapbox.com/v3/nbtsolutions.jbn3ge2f/{z}/{x}/{y}.png", {
        subdomains: 'abcd',
        maxZoom: 19
    });
    let OpenStreetMap_HOT = L.tileLayer('https://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}', {
        maxZoom: 20,
        attribution: 'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'    });

    Satellite.addTo(map);

    let Basemaps ={
        'Satelite':Satellite,
        'OST Map': OpenStreetMap_HOT,

    };
    let baseMaps = L.control.layers(Basemaps,null);
    baseMaps.addTo(map);

    //User Location Tool
    let currentPosition, currLatlngObject;
    let currentLatlng = [];

    function onLocationFound(e) {

        if (currentPosition) {
            map.removeLayer(currentPosition);
        }
//        let redMarker = L.ExtraMarkers.icon({
//            icon: 'fa-coffee',
//            markerColor: 'red',
//            shape: 'square',
//        });
//        icon: redMarker,

        currentPosition = L.marker(e.latlng,{title: "Location", draggable: false, color: "red"}).addTo(map);

        currLatlngObject = currentPosition._latlng;

        currentLatlng.push(currLatlngObject.lat);
        currentLatlng.push(currLatlngObject.lng);

        currentPosition.bindPopup("You are Here!").openPopup(console.log("Located"));
        map.setView([currentPosition._latlng.lat,currentPosition._latlng.lng],12);

    }

    function onLocationError(e) {
        console.log("location lost");
        console.log(e);
    }
    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    function locate() {
        map.locate({ maxZoom: 16});

    }

    let results = L.layerGroup().addTo(map);
    //GeoSearch plugin
    let searchControl = L.esri.Geocoding.geosearch().addTo(map);
    //Search Control
    searchControl.on('results', function(data){
        //Clears the results LayerGroup from the map
        results.clearLayers();

        for (let i = data.results.length - 1; i >= 0; i--) {
            //Displaying the searched and found location on the map
            let geoLocation = L.marker(data.results[i].latlng);

            results.addLayer(geoLocation);
        }

    });

    //Drawing Features being created
    let labelCount = 1;
    var drawnItems = new L.FeatureGroup();
    // Initialise the draw control and pass it the FeatureGroup of editable layers
    var drawControl = new L.Control.Draw({
        edit: {
            featureGroup: drawnItems
        }
    });
    map.on(L.Draw.Event.CREATED, function (e) {
        var type = e.layerType;
        var layer = e.layer;

        // Do whatever else you need to. (save to db, add to map etc)

        drawnItems.addLayer(layer);
    });

    function labelArea() {

        if (labelCount===1) {
            // Initialise the FeatureGroup to store editable layers
            map.addLayer(drawnItems);

            map.addControl(drawControl);

           console.log(labelCount);

            labelCount++;
        }
        else {
            map.removeControl(drawControl);
            map.removeControl(drawnItems);
            labelCount--;
            console.log(labelCount);
        }
    }

//Creating markers and popup displays
    let allMarkers = L.layerGroup([]);
    let users = L.layerGroup([]);
    let shelters = L.layerGroup([]);

    let newmarker = L.marker([44.808147, -68.795013]).addTo(allMarkers).addTo(users);
    newmarker.bindPopup(
        'User: Bob'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker1 = L.marker([44.808147, -68.785013]).addTo(allMarkers).addTo(users);
    newmarker1.bindPopup(
        'User: Fred'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker2 = L.CircleMarker([44.818147, -68.775013],
        {radius: 6,
            color:"#f44336"}).addTo(allMarkers).addTo(shelters);
    newmarker2.bindPopup(
        'Shelter'+'</br>'
    ).openPopup(console.log("Shelter"));
    let newmarker3 = L.marker([44.808147, -68.765013]).addTo(allMarkers).addTo(users);
    newmarker3.bindPopup(
        'User: Carl'+'</br>'+'<br/>'+
        'Status: Safe'+'</br>'
    ).openPopup(console.log("User"));
    let newmarker4 = L.marker([46.808147, -68.795013]).addTo(allMarkers).addTo(users);
    newmarker4.bindPopup(
        'User: Matty O'+'</br>'+'<br/>'+
        'Status: AYYYYY HELP'+'</br>'
    ).openPopup(console.log("User"));

    let markerCount = 1;

    let Markers = {
        "All": allMarkers,
        "Users": users,
        "Shelters": shelters,
    };
    let markerControls = L.control.layers(Markers, null);



    function marker(){

        if (markerCount === 1) {

            markerControls.addTo(map);
            markerCount++
        }
        else{
            markerControls.remove();
            markerCount--;
        }

        //
//  DO NOT TOUCH UNTIL YOU HAVE DATA CRAMER!!!!!

//        let currentMarker;
//
//        map.on("click", function (event) {
//            if (currentMarker) {
//                currentMarker._icon.style.transition = "transform 0.3s ease-out";
//                currentMarker._shadow.style.transition = "transform 0.3s ease-out";
//
//                currentMarker.setLatLng(event.latlng);
//
//                setTimeout(function () {
//                    currentMarker._icon.style.transition = null;
//                    currentMarker._shadow.style.transition = null;
//                }, 300);
//                return;
//            }
//
//            currentMarker = new L.marker(event.latlng, {
//                draggable: true
//            }).addTo(map).on("click", function () {
//                event.originalEvent.stopPropagation();
//            });
//
//            currentMarker.bindPopup(
//                'Marker Attributes'+'</br>'+'<br/>'+
//                'Marker Type Name:'+'</br>'+'<br/>'+
//                'User Text Insertion:'+'</br>'+'<br/>'+
//                'User Provided Photo/Video:'+'<br/>'+'<br/>'+
//                '<br/>'+
//                '<br/>'+'.'
//            ).openPopup(console.log("New Position"));
//
//        });
//
//        document.getElementById("done").addEventListener("click", function () {
//            currentMarker = null;
//        });


    }

</script>
</div>

<script> $('#mapPage').hide()</script>
<div class="login-page">
    <div class="form">
        <form class="register-form">
            <input id="registerName" type="text" placeholder="name"/>
            <input id="registerPasswrod" type="password" placeholder="password"/>
            <input id="registerEmail" type="text" placeholder="email address"/>

            <button>create</button>
            <p class="message">Already registered? <a href="#">Sign In</a></p>
        </form>
<!-- may need to move-->
        <form class="login-form">
            <p class="appName" >NATD App</p>
            <input id="userLogin" type="text" placeholder="username" value=""/>
            <input id="password"  type="password" placeholder="password" value=""/>
            <button type = "button" onclick="login()">login</button>
            <!--<p class="message">Not registered? <a href="#">Create an account</a></p>-->
        </form>
        <!-- IF WIFI IS DOWN OF SERVER IS DOWN user should still be allowed to draw or add information
        and store it on their phone, so the map is updated once they connect to wifi or a cell tower-->
    </div>

    <script>

        function login() {

            let userName = document.getElementById("userLogin").value;
            let user_password = document.getElementById("password").value;
            console.log(userName + "" +user_password);

            if (userName === "Cramer" && user_password === 'password') {
            alert("Welcome "+userName+"!");
           //This will dump the login and swap on the map
                //THIS WORKS FOR NOW
                //CHANGE WHEN YOU HAVE CREATED MULTIPLE
                // ACCOUNTS ITS HARD CODED

                $('.login-page').hide();
                $('#mapPage').show();

            }
            else
            {
                alert("Invalid Name or Password. " +
                    "Case sensitive!!");
            }
        }

    </script>
</div>

</body>

</html>